<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>{$admin_title}</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="renderer" content="webkit">
    <meta http-equiv="Content-Language" content="zh-CN">
    <link rel="shortcut icon" href="/favicon.ico"/>
    <script>
        YMWL_ROOT_URL = "{$baseroot?$baseroot:''}";
    </script>
    {/* 载入框架&插件CSS */}
    <link href="__libs__/layer/skin/layer.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <link href="__libs__/amaze/css/amazeui.min.css?v=__lkversion__" type="text/css" rel="stylesheet" />

    {/* 载入框架&插件JS */}
    <script type="text/javascript" src="__libs__/jquery/jquery.min.js?v=__lkversion__"></script>
    <script src="__libs__/jquery/jquery.form.min.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/jquery/jquery.cookie.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/layer/layer.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/amaze/js/amazeui.min.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/layui/layui.js?v=__lkversion__" type="text/javascript"></script>
    <link href="__libs__/layui/css/layui.css?v=__lkversion__" rel="stylesheet">
    <link href="__libs__/bootstrap/bootstrap.min.css?v=__lkversion__" type="text/css" rel="stylesheet"/>
    {/* 载入项目 CSS & JS */}
    <link href="__style__/admin/common.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <link href="__style__/admin/admin.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <link href="__style__/admin/reload.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <script src="__script__/admin/functions.js?v=__lkversion__" type="text/javascript"></script>
    <link href="__style__/admin/index.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <link href="__style__/admin/index_me.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <link href="__style__/admin/set.css?v=__lkversion__" type="text/css" rel="stylesheet" />
    <script src="__script__/admin/common_me.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/push/pusher.min.js?v=__lkversion__" type="text/javascript"></script>
    <script src="__libs__/adapter.js?v=__lkversion__"></script>
    <style>
    @font-face { font-family:'iconfont';
     src: url('/assets/alifont/iconfont.eot'); src: url('/assets/alifont/iconfont.eot?#iefix')
     format('embedded-opentype'), url('/assets/alifont/iconfont.woff')
     format('woff'), url('/assets/alifont/iconfont.ttf')
     format('truetype'), url('/assets/alifont/iconfont.svg#iconfont')
     format('svg');}
     .iconfont{ font-family:"iconfont"
 !important; font-size:16px;font-style:normal; -webkit-font-smoothing: antialiased; -webkit-text-stroke-width: 0.2px; -moz-osx-font-smoothing: grayscale;}
    </style>
    <script type="application/javascript">
        var mediaStreamTrack;
        var WEB_SOCKET_SWF_LOCATION = "__libs__/web_socket/WebSocketMain.swf";
        var WEB_SOCKET_DEBUG = true;
		var WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;
        var chat_data = Array();
        var record;
        var choose_lock = false;
        var myTitle = document.title;
        
       
        var msgreminder = {:config('setting.msgreminder')};
        var config ={
          'app_key':'hvum0wlkaz6n92ir',
          'whost':'{:config('wsip')}',
          'value':false,
          'wport':'{:config('wsport')}'
        };
        $.cookie('state','on');
        function titleBlink(){
        record++;

        if(record === 3){
             record =1;
        }
         
        if(record === 1){
            document.title='【 】'+myTitle;
        }

        if(record === 2){
            document.title='【消息】'+myTitle;
        }

        if(record > 3){
              getwaitnum();
             return;
        }

          setTimeout("titleBlink()",500);//调节时间，单位毫秒。
        }

        layui.use('element', function () {
           var element = layui.element;
        });
        var wolive_connect =function () {
            pusher = new Pusher(config.app_key, {
                encrypted: false
                , enabledTransports: ['ws']
                , wsHost: config.whost
                , wsPort: config.wport
                , authEndpoint: YMWL_ROOT_URL + '/admin/login/auth'
                ,disableStats: true
         });
            var userinfo=sessionStorage.getItem("userinfo");
            userinfo=JSON.parse(userinfo);
            var web = userinfo.business_id;
            var value =userinfo.service_id;
            // 私人频道
            var channelme = pusher.subscribe("ud" + value);
            channelme.bind("on_notice", function (data) {
                if(data.message.type == 'change'){
                    layer.msg(data.message.msg);
                }
                getchat();
                getwait();
            });

            channelme.bind("on_chat", function (data) {
               $.cookie("cu_com",'');
               layer.msg('该访客被删除');
               getchat();
            });
            // 公共平道
            var channelall = pusher.subscribe("all" + web);
            channelall.bind("on_notice", function (data) {
                if(userinfo.groupid == 0 || userinfo.groupid == data.message.groupid){
                    layer.msg(data.message.msg, {offset: "20px"});
                }

                if(userinfo.groupid != data.message.groupid){
                 
                     layer.msg('该用户向其他分组咨询！', {offset: "20px"});
                }

                  getwait();
                  getchat();
                
            });
            
            var channel =pusher.subscribe("kefu" + value);
            // 发送一个推送
            channel.bind("callbackpusher",function(data){
                $.post("{:url('admin/set/callback','',true,true)}",data,function(res){
                })
            });

            // 接受视频请求
            channel.bind("video",function (data) {
                getchat();
                var msg = data.message;
                var cha = data.channel;
                var cid = data.cid;
                var avatar =data.avatar;
                var username =data.username;
                layer.open({
                    type: 1,
                    title: '申请框',
                    area: ['260px', '160px'],
                    shade: 0.01,
                    fixed: true,
                    btn: ['接受', '拒绝'],
                    content: "<div style='position: absolute;left:20px;top:15px;'><img src='"+avatar+"' width='40px' height='40px' style='border-radius:40px;position:absolute;left:5px;top:5px;'><span style='width:100px;position:absolute;left:70px;top:5px;font-size:13px;overflow-x: hidden;'>"+username+"</span><div style='width:90px;height:20px;position:absolute;left:70px;top:26px;'>"+msg+"</div></div>",
                    yes: function () {
                        layer.closeAll('page');
                        var str='';
                        str+='<div class="videos">';
                        str+='<video id="localVideo" autoplay></video>';
                        str+='<video id="remoteVideo" autoplay class="hidden"></video></div>';


                        layer.open({
                          type:1
                          ,title: '视频'
                          ,shade:0
                          ,closeBtn:1
                          ,area: ['440px', '378px']
                          ,content:str
                          ,end:function(){

                           
                             mediaStreamTrack.getTracks().forEach(function (track) {
                                track.stop();
                            });
            
                          }
                      });
                        try{
                          connenctVide(cid);
                         }catch(e){
                             console.log(e);
                             return;
                         }
                        
                    },
                    btn2:function(){
                        var sid = $('#channel').text();
                        $.ajax({
                            url:YMWL_ROOT_URL+'/admin/set/refuse',
                            type:'post',
                            data:{channel:cha}
                        });

                        layer.closeAll('page');
                    }
                });
            });

            channel.bind('bind-wechat',function(data){
                layer.open({
                    content: data.message
                    ,btn: ['确定']
                    ,yes: function(index, layero){
                        location.reload();
                    }
                    ,cancel: function(){
                        return false;
                    }
                });
            });


            channel.bind('getswitch',function(data){
                layer.alert(data.message);
                getchat();
            });

            // 接受拒绝视频请求
            channel.bind("video-refuse",function (data) {
                layer.alert(data.message);
                layer.closeAll('page');
            });
            // 接受消息
            channel.bind("cu-event", function (data) {
                if("open" == 'open'){
                // if("{$voice}" == 'open'){
                    audioElementHovertree = document.createElement('audio');
                    audioElementHovertree.setAttribute('src', "/upload/voice/default.mp3");
                    audioElementHovertree.setAttribute('autoplay', 'autoplay');
                }
                var debug, portrait,showtime;
                var cdata = sessionStorage.getItem('cu_com');

                if (cdata) {
                    var json = $.parseJSON(cdata);
                    debug = json.visiter_id;
                    portrait = json.avatar;
                } else {
                    debug = "";

                }

                if($.cookie("time") == ""){
                    time =data.message.timestamp;
                    $.cookie("time",time);
                    var mydate =new Date(time*1000);
                    showtime =mydate.getHours()+":"+mydate.getMinutes();
                }else{
                    time =$.cookie("time");
                    if((data.message.timestamp - time) >60){
                        var mydate =new Date(data.message.timestamp*1000);
                        showtime =mydate.getHours()+":"+mydate.getMinutes();
                    }else{
                        showtime ="";
                    }
                    $.cookie("time",data.message.timestamp);
                }
                var msg = '';
                msg += '<li class="chatmsg"><div class="showtime">' +showtime+ '</div><div style="position: absolute;left:3px;">';
                msg += '<img class="my-circle  se_pic" src="' + portrait + '" width="50px" height="50px"></div>';
                msg += "<div class='outer-left'><div class='customer'>";
                msg += "<pre>" + data.message.content + "</pre>";
                msg += "</div></div>";
                msg += "</li>";
                var str = data.message.content;
                if (data.message.visiter_id == debug) {
                    $(".conversation").append(msg);
                    getwatch(data.message.visiter_id);


                    str.replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi, function (match, capture) {

                    var pos = capture.lastIndexOf("/");
                    var value = capture.substring(pos + 1);

                    if (value.indexOf("emo") == 0) {
                        str = data.message.content;
                    } else {
                        str = '[图片]';
                    }
                });

                str = str.replace(/<div><a[^<>]+><i>.+?<\/i>.+?<\/a><\/div>/,'[文件]');
                str = str.replace(/<a[^<>]+>.+?<\/a>/,'[超链接]');
                str =str.replace(/<img src=['"]([^'"]+)[^>]*>/gi,'[图片]');

                $("#msg" + data.message.channel).html(str);
             
                var div = document.getElementById("wrap");

                } 
                getnow(data.message);
                if(div){
                    div.scrollTop = div.scrollHeight;
                }
                $("#notices-icon").removeClass('hide');
                updatedata(JSON.parse(sessionStorage.getItem('cu_com')).visiter_id);
                console.log(data);
                notify(data.message.visiter_name || '新访客', {
                    body: str,
                    icon: data.message.avatar
                }, function(notification) {
                    //可直接打开通知notification相关联的tab窗口
                    window.focus();
                    notification.close();
                    console.log('#v'+data.message.channel+' .visit_content');
                    $('#v'+data.message.channel+' .visit_content').trigger('click');
                    // $('#v'+data.message.channel+' .visit_content').trigger('click');
                });
            });


            // 通知 游客离线
            channel.bind("logout", function (data) {


                //表示访客离线
                var cdata =  sessionStorage.getItem('cu_com');
                var chas;
                if (cdata) {
                    var jsondata = $.parseJSON(cdata);
                    chas = jsondata.channel;
                }

                if (chas == data.message.chas) {
                    //头像变灰
                    $("#v_state").text("离线");
                }

                $("#img" + data.message.chas).addClass("icon_gray");
              
                getchat();

            });

            channel.bind("geton", function (data) {

                //表示访客在线
                var cdata =  sessionStorage.getItem('cu_com');
                var chas;
                if (cdata) {
                    var jsondata = $.parseJSON(cdata);
                    chas = jsondata.channel;
                }
                if (chas == data.message.chas) {
                    //头像变亮
                    $("#img" + data.message.chas).removeClass("icon_gray");
                    $("#v_state").text("在线");
                }

                $("#img" + data.message.chas).removeClass("icon_gray");
                  //未读变已读
                console.log('游客在线');
                $(".readStatus").css('color','green');
                $(".readStatus").text('已读');
                getchat();

            });

            pusher.connection.bind('state_change', function(states) {
              
                if(states.current == 'unavailable' || states.current == "disconnected" || states.current == "failed" ){

                        pusher.unsubscribe("kefu" + value);
                        pusher.unsubscribe("all" + web);
                        pusher.unsubscribe("ud" + value);
            
                    if (typeof pusher.isdisconnect == 'undefined') {
                     pusher.isdisconnect = true;

                     pusher.disconnect();
                     delete pusher;
                     
                      window.setTimeout(function(){
                         wolive_connect();
                      },1000);
                    }

                 
                    $(".profile").text('离线');
                }
            });

            pusher.connection.bind('connected', function() {
                $(".profile").text('在线');
            });
        }


        function showpage(obj){

            var value =$(obj).attr("name");
            var key =$(obj).attr("id");
            layer.tips(value, '#'+key,{tips: [4, '#2F4050']});
        }



   </script>

    <script type="text/javascript" src="__libs__/web_socket/swfobject.js?v=__lkversion__"></script>
    <script type="text/javascript" src="__libs__/clipboard.min.js?v=__lkversion__"></script>
    <script type="text/javascript" src="__libs__/web_socket/web_socket.js?v=__lkversion__"></script>
    <script type="text/javascript" src="__script__/admin/online.js?v=__lkversion__"></script>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="__style__/admin/ymwl_common.css?v=__lkversion__123" type="text/css" rel="stylesheet" />
    <style>
    .layui-upload-list{
        display: flex;
    }
    .question_click{
        
    }
    .question_edit{
        color: black;
        padding: 0 5px;
    }
    .question_del{
        color: red;
        padding: 0 5px;
    }
    </style>    
</head>
<body>
<div id="set_tihuan" style="display:none"> 
    <div class="layui-form">
        <div class="layui-form-item">
            <label class="layui-form-label">勾选所需11</label>
            <div class="layui-input-inline layui-input-wrap">
              <input type="checkbox" name="choose_set" value="0" class="class_one" title="群发">
              <input type="checkbox" name="choose_set" value="1" class="class_one" title="打招呼" > 
              <input type="checkbox" name="choose_set" value="2" class="class_one" title="快捷回复" > 
              <input type="checkbox" name="choose_set" value="3" class="class_one" title="智能问答" > 
            </div>
           
        </div> 
        <div class="layui-form-item">
            <label class="layui-form-label">卡密</label>
            <div class="layui-input-inline layui-input-wrap">
              <input type="text" name="set_kami" placeholder="请输入卡密" autocomplete="off" lay-affix="clear" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label"></label>
            <div class="layui-input-inline layui-input-wrap">
                <button  class="layui-btn" id="set_savebtn">立即提交</button>
            </div>
        </div>
    </div>    
</div>     
<div id="qunfa_right" style="height:calc(100vh - 56px);position: relative;display:none;">
    <div class="qunfa_list" id="qunfa_data_list">

    </div>   
    <div class="alert_footer">
        <button class="layui-btn layui-bg-blue" lay-on="test-tips-prompt-text-qunfa" style="margin-right:30px;">新建文本群发</button>
        <button class="layui-btn " lay-on="test-tips-img-qunfa">新建图片群发</button>
    </div>    
</div>
<div id="kuaijie_right" style="height:calc(100vh - 56px);position: relative;display: none">
    <div class="qunfa_list"  id="kuaijie_data_list">
        
    </div>   
    <div class="alert_footer">
        <button class="layui-btn layui-bg-blue" lay-on="test-tips-prompt-text-kuaijie" data-type="text" style="margin-right:30px;margin-left:10px;">新建文本快捷回复</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-kuaijie" data-type="image" style="margin-right:30px;">新建图片快捷回复</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-kuaijie" data-type="audio" style="margin-right:30px;margin-top:10px;">新建音频快捷回复</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-kuaijie" data-type="vido" style="margin-right:30px;margin-top:10px;">新建视频快捷回复</button>
        
    </div>         
</div> 
<!--黑名单-->
<div id="blacklist_right">
    <div class="blacklist_right_list"  id="black_data_list">
        
    </div> 
</div>    
<!--打招呼 弹窗-->
<div  id="layer_lab_alert"  style="height:calc(100vh - 56px);position: relative;display: none">
    <div class="layui-tab" lay-filter="test-hash">
          <ul class="layui-tab-title">
                <li class="layui-this" lay-id="wenben">文本内容</li>
                <li lay-id="tupian">图片</li>
                <li lay-id="yinpin">音频</li>
                <li lay-id="shipin">视频</li>
          </ul>
          <div class="layui-tab-content">
                <div class="layui-tab-item layui-show" id="layertab-wenbn">
                    <div style="display: flex;flex-flow: column;align-items: center;">
                        <div style="width: 100%;margin-bottom: 20px;">
                           
                            <textarea  name="desc" id="layer_wenben_value"  placeholder="请输入内容" class="layui-textarea publicEditor uploadwenben"></textarea>
                        </div>
            
                        <div>
                            <button type="button" id="layer_wenben_submit" onclick="layertabneibusend('wenben')" class="layui-btn">发送文本</button>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item" id="layertab-img">
                    
                    <div style="display: flex;flex-flow: column;align-items: center;">
                        <button type="button" class="layui-btn" id="ID-upload-custom-btn">
                            <i class="layui-icon layui-icon-upload"></i> 多图片上传
                        </button> 
                        <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 11px;">
                            预览图：
                            <div class="layui-upload-list" id="upload-custom-preview"></div>
                        </blockquote>
                        <button type="button" id="layer_img_submit" onclick="layertabneibusend('img')" class="layui-btn">保存图片</button>
                    </div>
                </div>
                <div class="layui-tab-item" id="layertab-audio">
                    <div style="display: flex;flex-flow: column;align-items: center;">


                        <div style="width: 100%;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue layer_uploadaudio">点击上传</button>
                        </div>
                        <div >
                            <audio class="layer_uploadaudio" controls></audio>
                        </div>    
                        <div>
                            <button type="button" id="layer_audio_submit" onclick="layertabneibusend('audio')" class="layui-btn">保存音频</button>
                        </div>
                    </div> 
                </div>
                <div class="layui-tab-item" id="layertab-vidio">
                    <div style="display: flex;flex-flow: column;align-items: center;">

                        <div style="width: 100%;margin-right:10px;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue layer_uploadvidio">点击上传</button>
                        </div>
                        <div >
                            <video class="layer_uploadvidio" style="width:100px;height:92px;margin:11px 0;" controls></video>
                        </div> 
                        <div>
                            <button type="button" id="layer_vidio_submit" onclick="layertabneibusend('video')" class="layui-btn">保存视频</button>
                        </div>
                    </div>
                </div>
          </div>
    </div>
</div>
<!--打招呼左侧列表-->
<div id="dazhaohu_right" style="height:calc(100vh - 56px);position: relative;display: none">
    <div class="dazhaohu_list" id="dazhaohu_data_list">

    </div>   
    <div class="alert_footer">
        <button class="layui-btn layui-bg-blue" lay-on="test-tips-prompt-text-dazhaohu" data-type="text" style="margin-right:30px;margin-left:10px;">新建文本打招呼</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-dazhaohu" data-type="image" style="margin-right:30px;">新建图片打招呼</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-dazhaohu" data-type="audio" style="margin-right:30px;margin-top:10px;">新建音频打招呼</button>
        <button class="layui-btn " lay-on="test-tips-prompt-text-dazhaohu" data-type="vido" style="margin-right:30px;margin-top:10px;">新建视频打招呼</button>
        
    </div>    
</div>
<!--智能问答左侧列表-->
<div id="question_right" style="height:calc(100vh - 56px);position: relative;display: none">
    <div class="question_list" id="question_data_list">

    </div>   
    <div class="alert_footer">
        <button class="layui-btn layui-bg-blue" lay-on="test-tips-prompt-text-question" data-type="text" style="margin-right:30px;margin-left:10px;">添加智能问答</button>
    </div>    
</div>
<!--智能问答弹窗-->
<div id="alert_question" label-width="200px;" class="layui-form" style="padding:16px;display: none">
    
        <div class="layui-form-item">
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label" style="width: 150px;line-height: 19px;margin-right: 10px;">问题：</label>
                <div class="layui-input-block" style="margin-left:160px;">
                <input type="text" id="question_content" class="layui-input" value="">
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="display:none;">
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label" style="width: 150px;line-height: 19px;margin-right: 10px;">排序：</label>
                <div class="layui-input-block" style="margin-left:160px;">
                <input type="text" id="question_sort" class="layui-input" value="">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label" style="width: 150px;line-height: 19px;margin-right: 10px;">关键词：</label>
                <div class="layui-input-block" style="margin-left:160px;">
                <input type="text" id="question_keyword" class="layui-input" value="">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label"  style="width: 150px;line-height: 19px;margin-right: 10px;">类型：</label>
                <div class="layui-input-block" style="margin-left:160px;" >
                    <select id="question_type" lay-filter="demo-select-filter">
                      <option value="text" selected>文字</option>
                      <option value="image">图片</option>
                      <option value="audio">音频</option>
                      <option value="vido">视频</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item" >
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label"  style="width: 150px;line-height: 19px;margin-right: 10px;">问题回答：</label>
                <div class="layui-input-block" style="margin-left:160px;"  id="questtion_answer">
                    <div id="show_text_answer" >
                        <textarea   id="show_text_answer_value"  placeholder="请输入内容" class="layui-textarea uploadwenben questionwenben"></textarea>

                    </div>    
                    <div id="show_image_answer" style="display:none;">
                        <div style="width: 100%;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue show_image_answerbtn">点击上传</button>
                        </div>
                        <div >
                            <img class="show_image_answersrc" style="width:100px;height:92px;margin:11px 0;">
                        </div>    

                    </div>   
                    <div id="show_audio_answer" style="display:none;">
                        <div style="width: 100%;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue show_audio_answerbtn">点击上传</button>
                        </div>
                        <div >
                            <audio class="show_audio_answersrc" controls></audio>
                        </div>    

                    </div>   
                    <div id="show_vido_answer" style="display:none;">
                        <div style="width: 100%;margin-right:10px;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue show_vido_answerbtn">点击上传</button>
                        </div>
                        <div >
                            <video class="show_vido_answersrc" style="width:100px;height:92px;margin:11px 0;" controls></video>
                        </div> 

                    </div>   
                </div>  
            </div>
        </div>
        <div class="layui-form-item"> 
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label"  style="width: 150px;line-height: 19px;margin-right: 10px;">是否显示（客户端是否展示）：</label>
                <div class="layui-input-block" style="margin-left:160px;" >  
                  <input type="radio" name="question_status" value="1" title="显示" checked>
                  <input type="radio" name="question_status" value="0" title="不显示" > 
                </div>
            </div> 
        </div>
        <div class="layui-form-item" style="margin-top: 12px;text-align: center">
            <button class="layui-btn keep" id="question_save" data-id="0" onclick="savequestion()" >保存</button>
            <button type="reset" onclick="resetquestion()" class="layui-btn layui-btn-primary reset">取消</button>
        </div>
    
</div>
<div class="add_img_qunfa" style="text-align:center;padding-bottom: 20px;display:none" >
    <button type="button" class="layui-btn" id="ID-upload-demo-btn">
      <i class="layui-icon layui-icon-upload"></i> 单图片上传
    </button>
    <div style="width: 132px;margin: 0 auto;">
      <div class="layui-upload-list">
        <img class="layui-upload-img" id="ID-upload-demo-img" style="width: 100%; height: 92px;">
        <div id="ID-upload-demo-text"></div>
      </div>
      <div class="layui-progress layui-progress-big" lay-showPercent="yes" lay-filter="filter-demo">
        <div class="layui-progress-bar" lay-percent=""></div>
      </div>
    </div>
    <button type="button" class="layui-btn" lay-on="addto_img_qunfa" style="margin-top:10px;">
      <i class="layui-icon "></i> 添加到图片群发
    </button>
</div>

<div id="alert_tongji" style="padding: 15px;display:none">
    <div class="tongji_top" id="tongji_top" style="    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 16px;
    margin-bottom: 10px;">
        
    </div>
    <div class="tongji_bottom">
        <div class="tongji_bottom_title">
            统计(近7天新增数据)
        </div>    
        <div class="tongji_bottom_content" id="tongji_bottom_content">
              
        </div>    
    </div>    
</div>    
<div id="left_info_alert" style="display:none;position: absolute;
    top: 20px;
    left: 110px;
    z-index:10;
    background: #fff;
    border: 1px solid #b9b9b9;
    width: 300px;">
    <div class="page_containt">
        <div class="page_item_info">
            <div class="item_left_info">
                卡密:
            </div>
            <div class="item_right_info" id="userkami">
               <!--{$service['kami']}-->
            </div>    
        </div>   
        <div class="page_item_info">
            <div class="item_left_info">
                到期时间:
            </div>
            <div class="item_right_info" id="userendtime">
               <!--{$service['expire_time']}-->
            </div>    
        </div>  
        <div class="page_item_info">
            <button class="layui-btn"  id="left_info_alert_btn">续费</button>
            <button class="layui-btn"  id="left_info_alert_loginout">退出登录</button>
            <button class="layui-btn" data-clipboard-text=""   id="left_info_alert_cpoykami">复制卡密</button>
        </div>  
    </div>    
</div>    
<div style="display: none;" id="public_lab_alert" class="layui-code-item-preview">
    <div class="layui-form" id="show_dazhaohu" style="display:none;">
        <div class="layui-form-item">
            <div class="layui-inline" style="width:100%">
                <label class="layui-form-label" style="width: 150px;line-height: 19px;margin-right: 10px;">权重：</label>
                <div class="layui-input-block" style="margin-left:160px;display:none;">
                     <input type="text" id="dazhaohu_quanzhong" class="layui-input" value="">
                </div>
            </div>
        </div>
    </div>    
    <div class="layui-tab" lay-filter="test-hash">
          <ul class="layui-tab-title">
                <li class="layui-this" lay-id="wenben">文本内容</li>
                <li lay-id="tupian">图片</li>
                <li lay-id="yinpin">音频</li>
                <li lay-id="shipin">视频</li>
          </ul>
          <div class="layui-tab-content">
                <div class="layui-tab-item layui-show" id="layertab-wenbn">
                    <div style="display: flex;flex-flow: column;align-items: center;">
                        <div style="width: 100%;margin-bottom: 20px;">
                            <textarea  name="desc" id="wenben_value"  placeholder="请输入内容" class="layui-textarea publicEditor uploadwenben"></textarea>
                        </div>
            
                        <div>
                            <button type="button" id="wenben_submit" onclick="head_layertabneibusend('wenben')" class="layui-btn">发送文本</button>
            <!--                <button type="button" onclick="layertabneibusend('wenben')" class="layui-btn layui-btn-disabled">发送文本</button>-->
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item" id="layertab-img">
                    
                    <div style="display: flex;flex-flow: column;align-items: center;">

                        <button type="button" class="layui-btn" id="ID-upload-public-btn">
                            <i class="layui-icon layui-icon-upload"></i> 多图片上传
                        </button> 
                        <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 11px;">
                            预览图：
                            <div class="layui-upload-list" id="upload-public-preview"></div>
                        </blockquote>
                        <div>
                            <button type="button" id="img_submit" onclick="head_layertabneibusend('img')" class="layui-btn">发送图片</button>
                        </div>

                         
                    </div>
                </div>
                <div class="layui-tab-item" id="layertab-audio">
                    <div style="display: flex;flex-flow: column;align-items: center;">


                        <div style="width: 100%;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue uploadaudio">点击上传</button>
                        </div>
                        <div >
                            <audio class="uploadaudio" controls></audio>
                        </div>    
                        <div>
                            <button type="button" id="audio_submit" onclick="head_layertabneibusend('audio')" class="layui-btn">保存音频</button>
                        </div>
                    </div> 
                </div>
                <div class="layui-tab-item" id="layertab-vidio">
                    <div style="display: flex;flex-flow: column;align-items: center;">

                        <div style="width: 100%;margin-right:10px;">
                            <span style="color:red;">*</span>
                            <span style="margin-right:10px;">内容</span>
                            <button class="layui-btn layui-bg-blue uploadvidio">点击上传</button>
                        </div>
                        <div >
                            <video class="uploadvidio" style="width:100px;height:92px;margin:11px 0;" controls></video>
                        </div> 
                        <div>
                            <button type="button" id="vidio_submit" onclick="head_layertabneibusend('video')" class="layui-btn">保存视频</button>
                        </div>
                    </div>
                </div>
          </div>
    </div>
</div>

<div id="layout-west">
    <div id="layout-menus">
        <div id="layout-menus-info" >
            <a >
                <span class="info" style="width: 100%;
    height: 45px;
    font-size: 15px;
    text-decoration: none;
    color: #a7b1c2;
    padding:10px 0px 0px 12px;border-radius:25px;"> 
  
                    <img id="userlogo" src="{$seo['logo'] ? $seo['logo'] :$service['avatar']}" class="" style="width:38px;height:38px;border-radius:24px">
                    
                </span>
            </a>

        </div>

        <div id="layout-menus-lists">

            <ul id="group-menus-main" class="group-menus am-list ">
            
                
                
                

                {if $part == "客户咨询" }
                <li class="menu-item" id="title2"  style="color: #ffffff">
                    <span class="notices hide"></span>
                    <span class="notices-icon hide"></span>
                    <a  href="{:url('admin/index/chats')}" >
                        <i class="iconfont">&#xe604;</i>
                        <span style="color: #ffffff" class="info">消息</span>
                    </a>
                </li>
                {else}
                <li class="menu-item" id="title2" >
                    <!-- <i id="notices-icon" class="hide"></i> -->
                    <span class="notices hide"></span>
                    <span class="notices-icon hide"></span>
                    <a  href="{:url('admin/index/chats')}" >
                        <i class="iconfont">&#xe604;</i>
                        <span style="color: #fff" class="info">消息</span>
                    </a>
                </li>
                {/if}
                
                
                 <li class="menu-item" id="title3" >
                  <a href="javascript:erweima()" >
                    <i class="iconfont">&#xe600;</i>
                    <span style="color: #fff" class="info">二维码</span>
                  </a>
                 </li>
                 
                 
            
                 
           
                
                 
                 <li class="menu-item" id="title5" >
                      <a href="#"  lay-on="test-offset-r">
                        <i class="iconfont">&#xe60d;</i>
                        <span style="color: #fff" class="info">群发</span>
                      </a>
                      
                 </li>



                <li class="menu-item" id="title6">
                  <!--<a href="{:url('admin/index/custom')}" >-->
                  <a href="#" lay-on="test-offset-r-dazhaohu">
                    <i class="iconfont">&#xe6a7;</i>
                    <span style="color: #fff" class="info">打招呼</span>
                  </a>
                 </li>
                 
                <li class="menu-item" id="title7">
                  <!--<a href="{:url('admin/index/kuaijiehuifu')}" >-->
                  <!--  <i class="layui-icon">&#xe620;</i>-->
                  <!--  <span style="color: #fff" class="info">快捷回复</span>-->
                  <!--</a>-->
                  <a href="#"  lay-on="test-offset-r-kuaijie">
                    <i class="iconfont">&#xe61f;</i>
                    <span style="color: #fff" class="info">快捷</span>
                  </a>
                </li>
                 
                 
                 
                <li class="menu-item" id="title8" >
                  <!--<a href="{:url('admin/index/question')}" >-->
                  <a href="#" lay-on="test-offset-r-zhinengwenda" >
                    <i class="iconfont">&#xe632;</i>
                    <span style="color: #fff" class="info">智能</span>
                  </a>
                </li>

                {if $part == "首页" }
                <li class="menu-item" id="title1"  style="background: #ffffff;color: #353535">
                    <!--<a  href="{:url('admin/index/index')}" >-->
                    <a href="#"  lay-on="test-offset-r-tongji">
                        <i class="iconfont">&#xe65b;</i>
                        <span style="color: #353535" class="info">统计</span>
                    </a>
                </li>
                {else}
                <li class="menu-item" id="title1"  >
                    <a href="#"  lay-on="test-offset-r-tongji">
                        <i class="iconfont">&#xe61b;</i>
                        <span style="color: #fff" class="info">统计</span>
                    </a>
                </li>

                {/if}


     
                <li class="menu-item" id="title4" >

                  <a href="#"  lay-on="test-offset-r-blacklist">
                    <i class="iconfont">&#xe63a;</i>
                    <span style="color: #fff" class="info">黑名单</span>
                  </a>
                </li>
                <!--{if $part == "黑名单"}-->
                <!--    <li class="menu-item"  id="title4" onmouseover="showpage(this)" name="黑名单" style="background: #ffffff;">-->
                <!--        <a href="{:url('admin/custom/index')}">-->
                <!--            <i class="layui-icon">&#xe770;</i>-->
                <!--            <span style="color: #353535" class="info">黑名单</span>-->
                <!--        </a>-->
                <!--    </li>-->
                <!--    {else}-->
                <!--    <li class="menu-item"  id="title4" onmouseover="showpage(this)" name="黑名单">-->
                <!--        <a href="{:url('admin/custom/index')}">-->
                <!--            <i class="layui-icon">&#xe770;</i>-->
                <!--            <span style="color: #fff" class="info">黑名单</span>-->
                <!--        </a>-->
                <!--    </li>-->
                <!--{/if}-->
                 

               <!--{if $part == "接入方法"}-->
               <!-- <li class="menu-item" id="title9" onmouseover="showpage(this)" name="接入方法" style="background: #ffffff;">-->
               <!--     <a href="{:url('admin/index/front')}" >-->
               <!--         <i class="layui-icon">&#xe64d; </i>-->
               <!--         <span style="color: #353535" class="info">接入方法</span>-->
               <!--     </a>-->
               <!-- </li>-->

               <!-- {else}-->
               <!-- <li class="menu-item" id="title9" onmouseover="showpage(this)" name="接入方法">-->
               <!--     <a href="{:url('admin/index/front')}" >-->
               <!--         <i class="layui-icon">&#xe64d;</i>-->
               <!--         <span style="color: #fff" class="info">接入方法</span>-->
               <!--     </a>-->
               <!-- </li>-->
               <!-- {/if}-->
                     <li class="menu-item" id="title11">
                    <a href="{:url('admin/fangke/index')}" >    
                        <i class="iconfont">&#xe657;</i>
                        
                        <span style="color: #fff" class="info">访客</span>
                    </a>
                </li>
              
                <li class="menu-item" id="title11">
                    <a href="{:url('admin/index/setting')}" >
                        <i class="layui-icon">&#xe614;</i>
                        <span style="color: #fff" class="info">设置</span>
                    </a>
                </li>
                {if $is_we7 == 1}
                {if $part == '超级管理'}
                <li class="menu-item"  id="title11" style="background: #ffffff;">
                    <a href="{:url('manager/index/index')}">
                        <i class="layui-icon">&#xe6b2;</i>
                        <span style="color: #353535" class="info">超级管理</span>
                    </a>
                </li>
                {else}
                <li class="menu-item"  id="title11">
                    <a href="{:url('manager/index/index')}">
                        <i class="layui-icon">&#xe6b2;</i>
                        <span style="color: #fff" class="info">超级管理</span>
                    </a>
                </li>
                {/if}
                {/if}
          
                {:hook('adminleftmenuhook', ['part'=>$part])}
            </ul>
        </div>
    </div>
</div>
<script type="text/javascript" src="__assets__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__assets__/ueditor/ueditor.all.js"></script>
<script type="text/javascript">
    let qunfamsglit=[];
    let up_img_result='';
    //var head_layerTabUploadUrl="{:url('set/myupload')}"
    var head_layerTabUploadUrl="<?php echo uploadurl; ?>"
    const that=this;
    var editorOption = {
        UEDITOR_HOME_URL: "__assets__/ueditor/",
        UEDITOR_ROOT_URL: "__assets__/ueditor/",
        serverUrl: "{:url('upload/ueditor',['action'=>'config','service_id'=>$_SESSION['Msg']['service_id'],'admin_id'=>0])}",
        lang: "zh-cn",    
        zIndex:"39991015", 
        toolbars: [["undo", "redo", "|", "bold", "italic", "underline", "fontborder", "strikethrough", "superscript", "subscript", "removeformat", "formatmatch", "autotypeset", "blockquote", "pasteplain", "|", "forecolor", "backcolor",  "selectall", "cleardoc", "|","lineheight", "|", "customstyle", "paragraph", "fontfamily", "fontsize", "|","emotion","link", "unlink","|"]],
        initialContent: "",
        pageBreakTag: "_ueditor_page_break_tag_",
        initialFrameWidth: "100%",
        initialFrameHeight: "160", 
        initialStyle: "body{font-size:14px}",
        autoFloatEnabled: false,
        allowDivTransToP: true,
        autoHeightEnabled: false,
        charset: "utf-8",
    };
    var DomUe=UE.getEditor("wenben_value",editorOption)
    
     //var DomUe=UE.getEditor("wenben_value",editorOption)
    //var DomUe=UE.getEditor("wenben_value")
    $.ajax({
      url: location.origin+'/api/Serveruser/getserveruserBytoken',
      type: 'post',
      dataType : "json",
      async:false,
      beforeSend: function (request) {
            request.setRequestHeader("token",sessionStorage.getItem("token"));
      },
      data : { token :sessionStorage.getItem("token") },
      dataType: 'json',
    
      success: function(res){
          console.log(res)
          
           if(res.code=1){
              $('title').text(res.data.nick_name);
    	      $("#userkami").html(res.data.kami)
    	      $("#left_info_alert_cpoykami").attr("data-clipboard-text",res.data.kami)
    	      $("#userendtime").html(res.data.kamidata.dqtime)
    	      $("#userlogo").attr("src",location.origin+'/'+res.data.avatar)
    	      sessionStorage.setItem('userinfo',JSON.stringify(res.data)); 
    	   }
    	   else{
    	       
    	   }
      },
      
    
    })
    layui.use(function(){
      var layer = layui.layer;
      var util = layui.util;
      var $ = layui.$;
      var upload = layui.upload;
      var element = layui.element;
      var form = layui.form;
 
       // 单图片上传
      var uploadInst = upload.render({
        elem: '#ID-upload-demo-btn',
        url: head_layerTabUploadUrl, // 实际使用时改成您自己的上传接口即可。
        field:'upload',
        before: function(obj){
          // 预读本地文件示例，不支持ie8
          obj.preview(function(index, file, result){
            $('#ID-upload-demo-img').attr('src', result); // 图片链接（base64）
          });
          
          element.progress('filter-demo', '0%'); // 进度条复位
          layer.msg('上传中', {icon: 16, time: 0});
        },
        done: function(res){
            up_img_result='';
          // 若上传失败
          if(res.code > 0){
            return layer.msg('上传失败');
          }
          // 上传成功的一些操作
           console.log(res);
           up_img_result=res;
           $('#ID-upload-demo-text').html(''); // 置空上传失败的状态
        },
        error: function(){
          // 演示失败状态，并实现重传
          var demoText = $('#ID-upload-demo-text');
          demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
          demoText.find('.demo-reload').on('click', function(){
            uploadInst.upload();
          });
        },
        // 进度条
        progress: function(n, elem, e){
          element.progress('filter-demo', n + '%'); // 可配合 layui 进度条元素使用
          if(n == 100){
            layer.msg('上传完毕', {icon: 1});
          }
         
        }
      });
      var uploadInst2 = upload.render({
        elem: '#edit_img_btn',
        url: head_layerTabUploadUrl, // 实际使用时改成您自己的上传接口即可。
        field:'upload',
        before: function(obj){
          // 预读本地文件示例，不支持ie8
          obj.preview(function(index, file, result){
            $('#edit_qunfa_img').attr('src', result); // 图片链接（base64）
          });
          
          element.progress('filter-demo', '0%'); // 进度条复位
          layer.msg('上传中', {icon: 16, time: 0});
        },
        done: function(res){
            up_img_result='';
          // 若上传失败
          if(res.code > 0){
            return layer.msg('上传失败');
          }
          // 上传成功的一些操作
           console.log(res);
           up_img_result=res;
           $('#edit_img_text').html(''); // 置空上传失败的状态
        },
        error: function(){
          // 演示失败状态，并实现重传
          var demoText = $('#edit_img_text');
          demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
          demoText.find('.demo-reload').on('click', function(){
            uploadInst.upload();
          });
        },
        // 进度条
        progress: function(n, elem, e){
          element.progress('filter-demo', n + '%'); // 可配合 layui 进度条元素使用
          if(n == 100){
            layer.msg('上传完毕', {icon: 1});
          }
         
        }
      });
      form.on('select(demo-select-filter)', function(data){
        var elem = data.elem; // 获得 select 原始 DOM 对象
        var value = data.value; // 获得被选中的值
        var othis = data.othis; // 获得 select 元素被替换后的 jQuery 对象
        if(value=="text"){
            $("#show_text_answer").show()
            $("#show_image_answer").hide()
            $("#show_audio_answer").hide()
            $("#show_vido_answer").hide()
        }
        else if(value=="image"){
            $("#show_image_answer").show()
            $("#show_text_answer").hide()
            $("#show_audio_answer").hide()
            $("#show_vido_answer").hide()
        }
        else if(value=="audio"){
            $("#show_audio_answer").show()
            $("#show_image_answer").hide()
            $("#show_text_answer").hide()
            $("#show_vido_answer").hide()
        }
        else if(value=="vido"){
            $("#show_vido_answer").show()
            $("#show_image_answer").hide()
            $("#show_audio_answer").hide()
            $("#show_text_answer").hide()
        }
        
      });
      // 事件
      util.on('lay-on', {
        'test-offset-r': function(){
            img_file_list=[];
            $.ajax({
              url: location.origin+'/api/Massmailing/list',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
            
              success: function(res){
                  console.log(res)
                  res.data=res.data.data
                  if (res.code == 1) {
                    var html='';
                    $("#qunfa_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left">${res.data[i].content}</div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"   data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"   data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls=""></audio></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls=""></video></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                   
                    $("#qunfa_data_list").append(html)
                    $("#upload-public-preview").html('')
                    layer.open({
                        type: 1,
                        title:'我的群发',
                        offset: 'r',
                        anim: 'slideLeft', // 从右往左
                        area: ['520px', '100%'],
                        shade: 0.1,
                        shadeClose: true,
                        id: 'ID-demo-layer-direction-r-qunfa',
                        content: $("#qunfa_right")
                     });
                } else {
                    layer.msg("获取数据失败", {
                        icon: 2
                    });
                }
              },
              
            
            })

        },
        'test-offset-r-dazhaohu':function(){
            img_file_list=[];
            $.ajax({
              url: location.origin+'/api/Dazhaohu/list',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
            
              success: function(res){
                  console.log(res)
                  res.data=res.data.data
                  if (res.code == 1) {
                    var html='';
                    $("#dazhaohu_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left">${res.data[i].content}</div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"  data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"  data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls=""></audio></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"  data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls=""></video></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                   
                    $("#dazhaohu_data_list").append(html)
                    $("#upload-public-preview").html('')
                    layer.open({
                        type: 1,
                        title:'打招呼',
                        offset: 'r',
                        anim: 'slideLeft', // 从右往左
                        area: ['520px', '100%'],
                        shade: 0.1,
                        shadeClose: true,
                        id: 'ID-demo-layer-direction-r-dazhaohu',
                        content: $("#dazhaohu_right")
                     });
                } else {
                    layer.msg("获取数据失败", {
                        icon: 2
                    });
                }
              },
              
            
            })
        },
        'test-offset-r-zhinengwenda':function(){
            img_file_list=[];
            
            $.ajax({
              url: location.origin+'/api/Question/list',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
            
              success: function(res){
                  console.log(res)
                  res.data=res.data.data
                  if (res.code == 1) {
                    var html='';
                    $("#question_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"><div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div>
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                    
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left" > <div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div> 
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                    
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left" ><div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div> 
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"> <div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div> 
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                   
                    $("#question_data_list").append(html)
                    $("#upload-public-preview").html('')
                    layer.open({
                        type: 1,
                        title:'智能问答',
                        offset: 'r',
                        anim: 'slideLeft', // 从右往左
                        area: ['520px', '100%'],
                        shade: 0.1,
                        shadeClose: true,
                        id: 'ID-demo-layer-direction-r-question',
                        content: $("#question_right")
                     });
                  }
              }
            })
        },
        'test-offset-r-tongji':function(){
            $.ajax({
              url: location.origin+'/api/ServerUser/statistics',
              type: 'get',
              
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
              success:function(res){
                 res=JSON.parse(res);
                console.log("res",res)
                 $("#tongji_bottom_content").html("");
                var html=`

                         <div class="tongji_bottom_item">
                            <div class="tongji_bottom_item_left">今日新增</div>
                            <div class="tongji_bottom_item_right">新增客户：${res.today.ip}</div>
                        </div> 
                `
              
                var html2='';
                for(var i=0;i<res.list.length;i++){
                    html2+=`
                        <div class="tongji_bottom_item">
                            <div class="tongji_bottom_item_left">${res.list[i].time}</div>
                            <div class="tongji_bottom_item_right">新增客户：${res.list[i].number}</div>
                        </div>  
                    `
                }
                html=html+html2;
                $("#tongji_bottom_content").html(html);
                layer.open({
                    type: 1,
                    title:'统计',
                    offset: 'r',
                    anim: 'slideLeft', // 从右往左
                    area: ['520px', '100%'],
                    shade: 0.1,
                    shadeClose: true,
                    id: 'ID-demo-layer-direction-r-tongji',
                    content: $("#alert_tongji"),
                    success:function(){
                        keepalive()
                    }
                }); 
              }
            })
        },
        // 黑名单
        'test-offset-r-blacklist':function(){
            $.ajax({
              url: location.origin+'/api/Chat/getblacklist',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
              success:function(res){
                  var html=''
                  for(var i=0;i<res.data.length;i++){
                      html+=`
                        <div class="qunfa_item" data-id="${res.data[i].visiter_id}">
                            <div class="qunfa_item_left">${res.data[i].visiter_name}</div>
                            <div class="qunfa_item_right">
                               
                                <a href="#" data-id="${res.data[i].visiter_id}"  class="blacklist_del">移出</a>
                            </div>
                        </div>`
                        
                  }
                  $("#black_data_list").html(html)
                  //取消黑名单
                  $('.blacklist_del').click(function(){
                    
                    let visiter_id=$(this).attr('data-id');
                    let self=$(`.qunfa_item[data-id='${visiter_id}']`);
                    
                    $.ajax({
                        url: location.origin+'/api/Chat/removeblacklist',
                        type: 'post',
                        dataType : "json",
                        async:false,
                        beforeSend: function (request) {
                            request.setRequestHeader("token",sessionStorage.getItem("token"));
                        },
                        data : { visiter_id:visiter_id,token :sessionStorage.getItem("token") },
                        dataType: 'json',
                        
                        success: function(res){
                            console.log(res)
                            self.remove();
                            layer.msg(res.msg);
                            
                            setTimeout(function(){
                                window.location.reload();
                            },2000)
                            
                        },
                        
                        
                        })
                  });
                   
              }
            })
            layer.open({
                type: 1,
                title:'黑名单',
                offset: 'r',
                anim: 'slideLeft', // 从右往左
                area: ['520px', '100%'],
                shade: 0.1,
                shadeClose: true,
                id: 'ID-demo-layer-direction-r-blacklist',
                content: $("#black_data_list")
              });
        },
        'test-offset-r-kuaijie':function(){
            img_file_list=[];
            $.ajax({
              url: location.origin+'/api/Kuaijiehuifu/list',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
                success:function(res){
        
                    if(res.code == 1){
                        console.log("快捷回复list",res)
                        $("#kuaijie_data_list").html('')
                        var html='';
                        res.data=res.data.data;
                        for(var i=0;i<res.data.length;i++){
                            if(res.data[i].type=='text'){
                                html+=`
                                    <div class="qunfa_item" data-id="${res.data[i].id}">
                                        <div class="qunfa_item_left">${res.data[i].content}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                        </div>
                                    </div>  
                                `
                            }
                            else if(res.data[i].type=='image'){
                                html+=`
                                    <div class="qunfa_item" data-id="${res.data[i].id}">
                                        <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                            <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                        </div>
                                    </div>
                                `
                            }
                            else if(res.data[i].type=='audio'){
                                html+=`
                                    <div class="qunfa_item" data-id="${res.data[i].id}">
                                        <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls></audio></div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                            <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                        </div>
                                    </div>
                                `
                            }
                            else if(res.data[i].type=='vido'){
                                html+=`
                                    <div class="qunfa_item" data-id="${res.data[i].id}">
                                        <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls></video></div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                            <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                            <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                        </div>
                                    </div>
                                `
                            }
                           
                        }
                       
                        $("#kuaijie_data_list").append(html)
                        $("#upload-public-preview").html('')
                    }
        
                }
            })
              layer.open({
                type: 1,
                title:'快捷回复',
                offset: 'r',
                anim: 'slideLeft', // 从右往左
                area: ['520px', '100%'],
                shade: 0.1,
                shadeClose: true,
                id: 'ID-demo-layer-direction-r-kuaijie',
                content: $("#kuaijie_right")
              });
        },
        // 文本群发
        'test-tips-prompt-text-qunfa':function(){
            var ajaxsrc=location.origin+'/api/Massmailing/add';
            head_openLayerTab(ajaxsrc,"add","wenben","qunfa");
        },
        // 图片群发 
        "test-tips-img-qunfa":function(){
            var ajaxsrc=location.origin+'/api/Massmailing/add';
            head_openLayerTab(ajaxsrc,"add","img","qunfa");
        },
        // 快捷回复新增
        "test-tips-prompt-text-kuaijie":function(){
            //console.log()  
            var ajaxsrc=location.origin+'/api/Kuaijiehuifu/add'
            head_openLayerTab(ajaxsrc,"add","wenben","kuaijie");
        },
        // 打招呼新增
        "test-tips-prompt-text-dazhaohu":function(){
            var ajaxsrc=location.origin+'/api/Dazhaohu/add'
            head_openLayerTab(ajaxsrc,"add","wenben","dazhaohu");
        },
        // 智能问答
        "test-tips-prompt-text-question":function(){
            // http://ceshi.yusygoe.store/api/Kuaijiehuifu/add
            // var ajaxsrc=location.origin+'/api/Zhinengwenda/add'
            openquestion(0);
            $("#question_save").attr("data-id","0");
        },
        'addto_img_qunfa':function(){
            console.log(up_img_result); 
            var data={
                type:'image',
                content:up_img_result.data
            }
            $.post("{:url('admin/Qunfatem/add')}",data, function (res) {
                 console.log("新建图片群发结果",res)
                 if(res.code==0){
                     layer.closeAll('dialog'); 
                     layer.closeLast('page'); 
                     update_qunfa();
                 }
            })
        },
        'editto_img_qunfa':function(e){
         //没改过原来图   
          if(up_img_result==''){
              layer.closeAll('dialog'); 
            layer.closeLast('page'); 
          }
          else{
            var data={
                type:'image',
                id:e.context.dataset.id,
                content:up_img_result.data
            }
            $.post("{:url('admin/Qunfatem/edit')}",data, function (res) {
                 console.log("修改图片群发结果",res)
                 if(res.code==0){
                     layer.closeAll('dialog'); 
                     layer.closeLast('page'); 
                     update_qunfa();
                 }
            })  
          }
        },
        'test-tips-photos-one':function(e){
             console.log("???",e)
              layer.photos({
                photos: {
                  "title": "Photos",
                  "start": 0,
                  "data": [
                    {
                      "pid": 5,
                      "src": e[0].dataset.img,
                    }
                  ]
                },
                footer: false // 是否显示底部栏 --- 2.8.16+
              });
            },
    
      });

    });
    function keepalive(){
        
        setInterval(function () { 
            $.ajax({
                url:YMWL_ROOT_URL+"/api/ServerUser/statistics",
                 async:false,
                  beforeSend: function (request) {
                       request.setRequestHeader("token",sessionStorage.getItem("token"));
                  },
                  data : { token : sessionStorage.getItem("token") },
                type: "get",
                
            }).then(function (res){
                res=JSON.parse(res);
               // console.log("res",res)
               $("#tongji_bottom_content").html("");
                var html=`
                        <div class="tongji_bottom_item">
                            <div class="tongji_bottom_item_left">今日新增</div>
                            <div class="tongji_bottom_item_right">新增客户：${res.today.ip}</div>
                        </div> 
                `
              //  var html='';
               // $("#tongji_top").html(html);
                var html2='';
                for(var i=0;i<res.list.length;i++){
                    html2+=`
                        <div class="tongji_bottom_item">
                            <div class="tongji_bottom_item_left">${res.list[i].time}</div>
                            <div class="tongji_bottom_item_right">新增客户：${res.list[i].number}</div>
                        </div>  
                    `
                }
                html=html+html2;
                $("#tongji_bottom_content").html(html);
            })
        },3000);
        
    }

    $('#layout-menus-info').mouseover(function(){
        $('#left_info_alert').show();
    })
    $("#left_info_alert").mouseover(function(){
        $('#left_info_alert').show();
    })
    $("#left_info_alert").mouseout(function(){
        setTimeout(function(){
            $('#left_info_alert').hide();
        },1000)
    })



    $(document).on("click","#left_info_alert_btn", function(e) {
        console.log("123");
        layer.prompt({title: '请输入卡密'}, function(pass, index){
        layer.close(index);
        if(pass==''){
            layer.msg("卡密不能为空")
        }
        else{
            $.ajax({
                url: "/admin/login/renew",
                type:"post",
                data:{
                    kami:pass
                },
                success: function (res) {
                    console.log(res);
                    layer.msg(res.msg)
                }
            });
        }
        
       
      });
    })
    function update_qunfa(){
        $.ajax({
          url: location.origin+'/api/Massmailing/list',
          type: 'get',
          dataType : "json",
          async:false,
          beforeSend: function (request) {
               request.setRequestHeader("token",sessionStorage.getItem("token"));
          },
          data : { token : sessionStorage.getItem("token") },
          dataType: 'json',
        
          success: function(res){
              console.log(res)
              res.data=res.data.data;
              if (res.code == 1) {
                    var html='';
                    $("#qunfa_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left">${res.data[i].content}</div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls=""></audio></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls=""></video></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].id}" class="qunfa_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}"   data-type="${res.data[i].type}" class="qunfa_click">群发</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="qunfa_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}"  data-type="${res.data[i].type}" class="qunfa_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                       
                        
                    }
                    $("#qunfa_data_list").append(html)
                } else {
                    layer.msg("获取数据失败", {
                        icon: 2
                    });
                }
          }
        })
    }
    function update_kuaijie(){
        $.ajax({
            url: location.origin+'/api/Kuaijiehuifu/list',
            type: 'get',
            dataType : "json",
            async:false,
            beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
            },
            data : { token : sessionStorage.getItem("token") },
            dataType: 'json',
            success:function(res){
                res.data=res.data.data
                if(res.code == 1){
                    console.log("快捷回复list",res)
                    $("#kuaijie_data_list").html('')
                    var html='';
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left">${res.data[i].content}</div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls></audio></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].id}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls></video></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].id}" class="kuaijie_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_click">发送</a>
                                        <a href="#" data-id="${res.data[i].id}" data-img="${res.data[i].content}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].id}" data-server_id="${res.data[i].server_id}" data-type="${res.data[i].type}" class="kuaijie_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                   
                    $("#kuaijie_data_list").append(html)
                }
    
            }
        })
    }
    function update_dazhaohu(){
        $.ajax({
              url: location.origin+'/api/Dazhaohu/list',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
            
              success: function(res){
                  console.log(res)
                  res.data=res.data.data
                  if (res.code == 1) {
                    var html='';
                    $("#dazhaohu_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left">${res.data[i].content}</div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"   data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><img class="qunfa_item_img" src="${res.data[i].content}"></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"   data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><audio class="uploadaudio" src="${res.data[i].content}" controls=""></audio></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"   data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="qunfa_item" data-id="${res.data[i].sid}">
                                    <div class="qunfa_item_left" lay-on="test-tips-photos-one" data-img="${res.data[i].content}"><video class="uploadvidio" src="${res.data[i].content}" style="width:100px;height:92px;margin:11px 0;" controls=""></video></div>
                                    <div class="qunfa_item_right">
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_up">上移</a>
                                        <a href="#" data-id="${res.data[i].sid}" class="dazhaohu_click_down">下移</a>
                                        <a href="#" data-id="${res.data[i].sid}" data-img="${res.data[i].content}"   data-type="${res.data[i].type}" class="dazhaohu_edit">编辑</a>
                                        <a href="#" data-id="${res.data[i].sid}"   data-type="${res.data[i].type}" class="dazhaohu_del">删除</a>
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                   
                    $("#dazhaohu_data_list").append(html)
                    $("#upload-public-preview").html('')
                } else {
                    layer.msg("获取数据失败", {
                        icon: 2
                    });
                }
              },
              
            
            })
    }
    function update_zhinengwenda(){
        $.ajax({
              url: location.origin+'/api/Question/list',
              type: 'get',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                   request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token : sessionStorage.getItem("token") },
              dataType: 'json',
            
              success: function(res){
                  console.log(res)
                  res.data=res.data.data
                  if (res.code == 1) {
                    var html='';
                    $("#question_data_list").html('')
                    for(var i=0;i<res.data.length;i++){
                        if(res.data[i].type=='text'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"><div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div>
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>  
                            `
                        }
                        else if(res.data[i].type=='image'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"> <div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div>
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='audio'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"> <div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div>
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>
                            `
                        }
                        else if(res.data[i].type=='vido'){
                            html+=`
                                <div class="question_item" data-id="${res.data[i].qid}">
                                    <div class="question_title">
                                        <div class="qunfa_item_left"> <div class="question_tips">Q${i+1}</div>${res.data[i].question}</div>
                                        <div class="qunfa_item_right">
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_up">上移</a>
                                            <a href="#" data-id="${res.data[i].qid}" class="question_click_down">下移</a>
                                            <a href="#" class="question_edit" data-question="${res.data[i].question}" data-keyword="${res.data[i].keyword}" data-sort="${res.data[i].sort}"   data-type="${res.data[i].type}" onclick="openquestion(${res.data[i].qid},'${res.data[i].type}',this)">编辑</a>
                                            <a href="#"  class="question_del"   onclick="getdelete(${res.data[i].qid})">删除</a>
                                        </div>
                                    </div>
                                    <div class="question_answer">
                                        ${res.data[i].answer}
                                    </div>
                                </div>
                            `
                        }
                       
                    }
                    $("#question_data_list").append(html)
                    $("#upload-public-preview").html('')
                  }
              }
        })
    }
    function savequestion(){
        console.log('保存');
        if(flag2){
            flag2=false;
            var q = $("#question_content").val();
            var k = $("#question_keyword").val();
    
            var a = ''
            var sort =$("#question_sort").val();
            var status = $("input[name='question_status']:checked").val();
            var b="";
            var type=$("#question_type").val();
            if(type=="text"){
                a=DomUe2.getContent()
                b=DomUe2.getContent()
            }
            else if(type=="image"){
                a=$(".show_image_answersrc").eq(0).attr("src")
                 b="<img style='max-width:200px;max-height:200px;' src='"+a+"'>"
            }
            else if(type=="audio"){
                
                a=$(".show_audio_answersrc").eq(0).attr("src")
                b="<audio style='max-width:200px;max-height:200px;' src='"+a+"' controls></audio>"
            }
            else if(type=="vido"){
                a=$(".show_vido_answersrc").eq(0).attr("src")
                b="<video style='max-width:200px;max-height:200px;' src='"+a+"' controls></video>"
            }
            if (q) {
                var id=$("#question_save").attr("data-id")
                if(id==0){
                    $.ajax({
                   
                        url: location.origin + '/api/Question/add',
                        type: 'post',
                        beforeSend: function (request) {
                                request.setRequestHeader("token",sessionStorage.getItem("token"));
                        },
                        data: {question: q,keyword:k,type:type,answer_src:a, answer: b, qid: id,sort:sort,status:status, token :sessionStorage.getItem("token")},
                        success: function (res) {
    
                            if (res.code == 1) {
                                layer.msg(res.msg, {time:1000, icon:1, shift:6}, function () {
                                        layer.closeAll('dialog'); 
                                       layer.closeLast('page')
                                       update_zhinengwenda()
                                });
    
                            } else {
                                layer.msg(res.msg, {
                                    icon: 2
                                });
                            }
                            lock = false;
                        }
                    });
                }
                else{
                    $.ajax({
                   
                        url: location.origin + '/api/Question/edit',
                        type: 'post',
                        beforeSend: function (request) {
                                request.setRequestHeader("token",sessionStorage.getItem("token"));
                        },
                        data: {
                            question: q,
                            keyword:k,
                            type:type,
                            answer_src:a,
                            answer: b, 
                            id: id,
                            sort:sort,
                            status:status,
                            token :sessionStorage.getItem("token")
                            
                        },
                        success: function (res) {
    
                            if (res.code == 1) {
                                layer.msg(res.msg, {
                                    icon: 1, end: function () {
                                        layer.closeAll('dialog'); 
                                       layer.closeLast('page')
                                       update_zhinengwenda()
                                    }
                                });
                            } else {
                                layer.msg(res.msg, {
                                    icon: 2
                                });
                            }
                            lock = false;
                        }
                    });
                }
                    
            } else {
                layer.msg('数据不完整');
            }
        }
        else{
            return 0;
        }
        
    }
    function header_qunfasend(content) {
        let ids=getAllSelectIds();
        //let msg=$('#alertTextMsg').val();
        let msg=content;
        var sdata = $.cookie('cu_com');
        var unstr=(new Date()).valueOf()+randomChar(5);
        if (sdata) {
            var json = $.parseJSON(sdata);
            var img = json.avater;
        }
        console.log(ids);
        console.log(msg);
        console.log(img);
        console.log(unstr);
        $.ajax({
           
            url:location.origin+"/api/Chat/chats",
            type: "post",
             async:false,
                beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
                },
            data: {visiter_id:ids,content: msg, avatar: img,unstr:unstr,token:sessionStorage.getItem("token")}
        }).then(function (res){
            //console.log(sdata);
            // sdata=JSON.parse(sdata);
            // console.log(sdata);
            // console.log('res',res);
            // qunfamsglit.push({
            //     'showtime':sdata.timestamp,
            //     'content':sdata.content,
            // });
           
            $('.layui-textarea').eq(1).val('');
            layer.msg('发布成功');
            location.reload();
        });
    }

    function getAllSelectIds(){
        let ids=[];
        $('.visiter').each(function () {
            ids.push($(this).attr('visid'));
        })
        ids=ids.join(',');
        return ids;
    }
    $(document).on("click",".qunfa_del", function(e) {
        console.log("删除按钮被点击了",e);
        layer.confirm('是否确认删除？', {icon: 3}, function(){

            $.ajax({
              url: location.origin+'/api/Massmailing/del',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id:e.target.dataset.id },
              dataType: 'json',
            
              success: function(res){
                  layer.closeLast('page')
                  layer.closeAll('dialog'); 
                 update_qunfa();
                 update_kuaijie();
                 update_dazhaohu();
                 update_zhinengwenda();
                layer.msg('删除成功', {icon: 1});
              }
            })

        }, function(){
            
        });
    });
    $(document).on("click",".qunfa_edit", function(e) {
        console.log("群发编辑按钮被点击了",e);
        var edit_type=e.target.dataset.type;
        var id=e.target.dataset.id
            var src=e.target.dataset.img
            var type=e.target.dataset.type
            $("#edit_qunfa_img").attr("src",src);
            $("#save_edit_btn").attr("data-id",id);
            $("#save_edit_btn").attr("data-type",type);
            $("#save_edit_btn").attr("data-src",src);
             img_file_list=[];
             $('#upload-public-preview').html('')
        if(edit_type=="text"){
            var value= e.target.parentElement.previousElementSibling.innerHTML;
            console.log(value);
           
           var data={
               id:e.target.dataset.id,
               type:"text",
               content:value
           }
           var ajaxsrc=location.origin+'/api/Massmailing/edit';
           head_openLayerTab(ajaxsrc,"edit","wenben",data);
       }
       else if(edit_type=="image"){
           up_img_result='';
           head_layerTabBefosendData['img']= e.target.dataset.img
                    img_file_list[0]= e.target.dataset.img
            // $('#upload-public-preview').append('<img  src="'+ e.target.dataset.img +'"  style="width: 90px; height: 90px;">');
          $('#upload-public-preview').append('<div class="upimg-div"><div class="upimg-del">删除</div><img  src="'+ e.target.dataset.img +'" alt="'+ e.target.dataset.img +'" style="width: 90px; height: 90px;"></div>');
           var data={
               id:e.target.dataset.id,
               type:"image",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Massmailing/edit';
           head_openLayerTab(ajaxsrc,"edit","image",data);
       }
       else if(edit_type=="audio"){
           $("#audio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"audio",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Massmailing/edit';
           head_openLayerTab(ajaxsrc,"edit","audio",data);
       }
       else if(edit_type=="vido"){
           $("#vidio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"vido",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Massmailing/edit';
           head_openLayerTab(ajaxsrc,"edit","vido",data);
       }


    });
     $(document).on("click",".qunfa_click", function(e) {
        console.log("群发按钮被点击了",e);
        let self=this;
        layer.confirm('是否确认群发？', {icon: 3}, function(){
            if(e.target.dataset.type=='image'){
                header_qunfasend(e.target.parentElement.previousElementSibling.children[0].outerHTML);
            }
            else if(e.target.dataset.type=='audio'){
                header_qunfasend(e.target.parentElement.previousElementSibling.children[0].outerHTML);
            }
            else if(e.target.dataset.type=='vido'){
                header_qunfasend(e.target.parentElement.previousElementSibling.children[0].outerHTML);
            }
            else if(e.target.dataset.type=='text'){
                header_qunfasend(e.target.parentElement.previousElementSibling.innerHTML)
            }
            
            let content=$(self).parents('.qunfa_item').find('.qunfa_item_left').html();
            console.log(content);
            
           
        }, function(){
            layer.msg('点击取消的回调');
        });
    });
    $(document).on("click",".qunfa_click_up", function(e) {
        console.log("群发上移",e);
        if(e.currentTarget.parentElement.parentElement.previousElementSibling!=null){
            var lastid=e.currentTarget.parentElement.parentElement.previousElementSibling.dataset.id
            
           
            $.ajax({
              url: location.origin+'/api/Massmailing/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:lastid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("上移成功")
                update_qunfa();
              }
            })
        }
        else{
            layer.msg("已是第一个")
        }
    })
    $(document).on("click",".qunfa_click_down", function(e) {
        console.log("群发下移",e);
        if(e.currentTarget.parentElement.parentElement.nextElementSibling!=null){
             var nextid=e.currentTarget.parentElement.parentElement.nextElementSibling.dataset.id
             $.ajax({
              url: location.origin+'/api/Massmailing/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:nextid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("下移成功")
                
               update_qunfa();
              }
            })
        }
        else{
            layer.msg("已是最后一个")
        }
    })
    $(document).on("click",".dazhaohu_click_up", function(e) {
        console.log("群发上移",e);
        if(e.currentTarget.parentElement.parentElement.previousElementSibling!=null){
            var lastid=e.currentTarget.parentElement.parentElement.previousElementSibling.dataset.id
            
           
            $.ajax({
              url: location.origin+'/api/Dazhaohu/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:lastid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("上移成功")
                update_dazhaohu()
              }
            })
        }
        else{
            layer.msg("已是第一个")
        }
    })
    $(document).on("click",".dazhaohu_click_down", function(e) {
        console.log("群发下移",e);
        if(e.currentTarget.parentElement.parentElement.nextElementSibling!=null){
             var nextid=e.currentTarget.parentElement.parentElement.nextElementSibling.dataset.id
             $.ajax({
              url: location.origin+'/api/Dazhaohu/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:nextid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("下移成功")
                
                update_dazhaohu()
              }
            })
        }
        else{
            layer.msg("已是最后一个")
        }
    })
    $(document).on("click",".kuaijie_click_up", function(e) {
        console.log("群发上移",e);
        if(e.currentTarget.parentElement.parentElement.previousElementSibling!=null){
            var lastid=e.currentTarget.parentElement.parentElement.previousElementSibling.dataset.id
            
           
            $.ajax({
              url: location.origin+'/api/Kuaijiehuifu/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:lastid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("上移成功")
                update_kuaijie();
              }
            })
        }
        else{
            layer.msg("已是第一个")
        }
    })
    $(document).on("click",".kuaijie_click_down", function(e) {
        console.log("群发下移",e);
        if(e.currentTarget.parentElement.parentElement.nextElementSibling!=null){
             var nextid=e.currentTarget.parentElement.parentElement.nextElementSibling.dataset.id
             $.ajax({
              url: location.origin+'/api/Kuaijiehuifu/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:nextid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("下移成功")
                
                update_kuaijie();
              }
            })
        }
        else{
            layer.msg("已是最后一个")
        }
    })
    $(document).on("click",".question_click_up", function(e) {
        console.log("群发上移",e);
        if(e.currentTarget.parentElement.parentElement.previousElementSibling!=null){
            var lastid=e.currentTarget.parentElement.parentElement.previousElementSibling.dataset.id
            
           
            $.ajax({
              url: location.origin+'/api/Question/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:lastid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("上移成功")
                 update_zhinengwenda();
              }
            })
        }
        else{
            layer.msg("已是第一个")
        }
    })
    $(document).on("click",".question_click_down", function(e) {
        console.log("群发下移",e);
        if(e.currentTarget.parentElement.parentElement.nextElementSibling!=null){
             var nextid=e.currentTarget.parentElement.parentElement.nextElementSibling.dataset.id
             $.ajax({
              url: location.origin+'/api/Question/exchangeWeigh',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id1:e.target.dataset.id,id2:nextid },
              dataType: 'json',
            
              success: function(res){
                layer.msg("下移成功")
                
                update_zhinengwenda();
              }
            })
        }
        else{
            layer.msg("已是最后一个")
        }
    })
    
    $(document).on("click",".kuaijie_del", function(e) {
        console.log("删除按钮被点击了",e);
        layer.confirm('是否确认删除？', {icon: 3}, function(){

            $.ajax({
              
              url: location.origin+'/api/Kuaijiehuifu/del',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id:e.target.dataset.id },
              dataType: 'json',
            
              success: function(res){
                 update_kuaijie();
                layer.msg('删除成功', {icon: 1});
              } 
            });
            
            
        }, function(){
            
        });
    });
    $(document).on("click",".kuaijie_edit", function(e) {
        console.log("快捷编辑按钮被点击了",e);
        var edit_type=e.target.dataset.type;
        up_img_result='';
        var id=e.target.dataset.id
        var src=e.target.dataset.img
        var type=e.target.dataset.type
        $("#edit_qunfa_img").attr("src",src);
        $("#save_edit_btn").attr("data-id",id);
        $("#save_edit_btn").attr("data-type",type);
         $("#save_edit_btn").attr("data-src",src);
         img_file_list=[];
          $('#upload-public-preview').html('')
        if(edit_type=="text"){
            var value= e.target.parentElement.previousElementSibling.innerHTML;
            console.log(value);
           
           var data={
               id:e.target.dataset.id,
               type:"text",
               content:value
           }
           var ajaxsrc=location.origin+'/api/Kuaijiehuifu/edit'
           head_openLayerTab(ajaxsrc,"edit","wenben",data);
       }
       else if(edit_type=="image"){
           
           head_layerTabBefosendData['img']= e.target.dataset.img
           img_file_list[0]= e.target.dataset.img
           
        //   '<img  src="'+ e.target.dataset.img +'"  style="width: 90px; height: 90px;">'
            $('#upload-public-preview').append('<div class="upimg-div"><div class="upimg-del">删除</div><img  src="'+ e.target.dataset.img +'" alt="'+ e.target.dataset.img +'" style="width: 90px; height: 90px;"></div>');
           var data={
               id:e.target.dataset.id,
               type:"image",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Kuaijiehuifu/edit'
           head_openLayerTab(ajaxsrc,"edit","image",data);
       }
       else if(edit_type=="audio"){
           $("#audio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"audio",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Kuaijiehuifu/edit'
           head_openLayerTab(ajaxsrc,"edit","audio",data);
       }
       else if(edit_type=="vido"){
           $("#vidio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"vido",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Kuaijiehuifu/edit'
           head_openLayerTab(ajaxsrc,"edit","vido",data);
       }
    });
     $(document).on("click",".kuaijie_click", function(e) {
        console.log("发送按钮被点击了",e);
        var huifuid=e.target.dataset.id;
        let self=this;
        layer.confirm('是否确认发送？', {icon: 3}, function(){
            var kuaijie_content=e.target.parentElement.previousElementSibling.innerHTML
            
            var sid = $('#channel').text();
            // var se = $("#chatmsg_submit").attr('name');
            var customer = $("#customer").text();
            var pic = $(".info img").attr("src"); 
            var time,img;
            var sdata = $.cookie('cu_com');
            if (sdata) {
                var json = $.parseJSON(sdata);
                img = json.avater;
            }
            if($.cookie("time") == ""){
                var myDate = new Date();
                var minutes = myDate.getMinutes();
                if(minutes < 10 ) {
                    minutes = '0'+minutes.toString();
                }
                time = myDate.getHours()+":"+minutes;
                var timestamp = Date.parse(new Date());
                $.cookie("time",timestamp/1000);
    
            }else{
                var timestamp = Date.parse(new Date());
                var lasttime =$.cookie("time");
                if((timestamp/1000 - lasttime) >30){
                    var myDate =new Date(timestamp);
                    var minutes = myDate.getMinutes();
                    if(minutes < 10 ) {
                        minutes = '0'+minutes.toString();
                    }
                    time = myDate.getHours()+":"+minutes;
                }else{
                    time ="";
                }
                $.cookie("time",timestamp/1000);
            }
            var unstr=(new Date()).valueOf()+randomChar(5)+sid;
            var str = '';
            str=creatChatHtmlMdg(kuaijie_content);
            
    
            $(".conversation").append(str);
            var div = document.getElementById("wrap");
            div.scrollTop = $('.conversation')[0].scrollHeight;
            $(".chatmsg").css({
                height: 'auto'
            });
    
            $.ajax({
                url:YMWL_ROOT_URL+"/api/Chat/chats",
                beforeSend: function (request) {
                        request.setRequestHeader("token",sessionStorage.getItem("token"));
                },
                type: "post",
                data: {visiter_id:sid,content: kuaijie_content, avatar: img,unstr:unstr,token :sessionStorage.getItem("token")}
            });
            $("#text_in").focus();
            layer.closeLast('dialog');
            // let content=$(self).parents('.qunfa_item').find('.qunfa_item_left').html();
            // console.log(content);
            
           
        }, function(){
            layer.msg('点击取消的回调');
        });
    });
    $(document).on("click",".dazhaohu_del", function(e) {
        console.log("删除按钮被点击了",e);
        layer.confirm('是否确认删除？', {icon: 3}, function(){

            $.ajax({
              url: location.origin+'/api/Dazhaohu/del',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id:e.target.dataset.id },
              dataType: 'json',
            
              success: function(res){
                 update_dazhaohu();
                layer.msg('删除成功', {icon: 1});
              }
            })

        }, function(){
            
        });
    });
    $(document).on("click",".dazhaohu_edit", function(e) {
        console.log("打招呼编辑按钮被点击了",e);
        var edit_type=e.target.dataset.type;
        var id=e.target.dataset.id
            var src=e.target.dataset.img
            var type=e.target.dataset.type
            $("#edit_qunfa_img").attr("src",src);
            $("#save_edit_btn").attr("data-id",id);
            $("#save_edit_btn").attr("data-type",type);
            $("#save_edit_btn").attr("data-src",src);
             img_file_list=[];
             $('#upload-public-preview').html('')
        if(edit_type=="text"){
            var value= e.target.parentElement.previousElementSibling.innerHTML;
            console.log(value);
           
           var data={
               id:e.target.dataset.id,
               type:"text",
               content:value
           }
           var ajaxsrc=location.origin+'/api/Dazhaohu/edit';
           head_openLayerTab(ajaxsrc,"edit","wenben",data);
       }
       else if(edit_type=="image"){
           up_img_result='';
           head_layerTabBefosendData['img']= e.target.dataset.img
           img_file_list[0]= e.target.dataset.img
            // $('#upload-public-preview').append('<img  src="'+ e.target.dataset.img +'"  style="width: 90px; height: 90px;">');
          $('#upload-public-preview').append('<div class="upimg-div"><div class="upimg-del">删除</div><img  src="'+ e.target.dataset.img +'" alt="'+ e.target.dataset.img +'" style="width: 90px; height: 90px;"></div>');
           var data={
               id:e.target.dataset.id,
               type:"image",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Dazhaohu/edit';
           head_openLayerTab(ajaxsrc,"edit","image",data);
       }
       else if(edit_type=="audio"){
           $("#audio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"audio",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Dazhaohu/edit';
           head_openLayerTab(ajaxsrc,"edit","audio",data);
       }
       else if(edit_type=="vido"){
           $("#vidio_submit").parent().prev().children().attr("src",e.target.dataset.img)
           var data={
               id:e.target.dataset.id,
               type:"vido",
               content:e.target.dataset.img
           }
           var ajaxsrc=location.origin+'/api/Dazhaohu/edit';
           head_openLayerTab(ajaxsrc,"edit","vido",data);
       }


    });

</script>
<script type="text/javascript" src="__script__/ajaxuploadimg.js"></script>
<script>
    var loadstatus='';
     var flag = true;
      var flag2 = true;
    //var head_layerTabUploadUrl="{:url('set/myupload')}"
    var head_layerTabUploadUrl="<?php echo uploadurl; ?>"
    var img_file_list=[];
    //准备发送前的数据！
    let head_layerTabBefosendData={
        'wenben':'',
        'img':'',
        'audio':'',
        'video':'',
    };
    //openLayerTab();
    layui.use(function(){
      var upload = layui.upload;
      var layer = layui.layer;
      var element = layui.element;
      var $ = layui.$;
      img_file_list=[]
      // 单图片上传
       inst=upload.render({
        elem: '#ID-upload-public-btn',
        url: head_layerTabUploadUrl, // 实际使用时改成您自己的上传接口即可。
        multiple: true, 
        field:'upload',
        before: function(obj){
          // 预读本地文件示例，不支持ie8
          
        },
        choose: function(obj){
          // 将每次选择的文件追加到文件队列
          // 预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
          obj.preview(function(index, file, result){
            console.log(index); // 得到文件索引
            //console.log(file); // 得到文件对象
            //console.log(result); // 得到文件base64编码，比如图片
            
            // obj.resetFile(index, file, '123.jpg'); // 重命名文件名
            
            // 这里还可以做一些 append 文件列表 DOM 的操作
            
            // obj.upload(index, file); // 对上传失败的单个文件重新上传，一般在某个事件中使用
            // delete files[index]; //删除列表中对应的文件，一般在某个事件中使用
          });
          loadstatus=layer.msg('加载中', {
            icon: 16,
            shade: 0.01  ,
            time:1000000000
          });

        },
        done: function(res){
          // 上传完毕
          console.log("!!!!",res);
          $('#upload-public-preview').append('<div class="upimg-div"><div class="upimg-del">删除</div><img  src="'+ res.data +'" alt="'+ res.data +'" style="width: 90px; height: 90px;"></div>');
          img_file_list.push(res.data)
        },
        allDone: function(obj){
          console.log("total",obj); // 上传的文件总数
          if(obj.total==obj.successful){
              layer.close(loadstatus);
          }
          
        }
      });
    });
    Array.prototype.indexOf = function(val) {
        for (var i = 0; i < this.length; i++) {
        if (this[i] == val) return i;
        }
        return -1;
    };
    Array.prototype.remove = function(val) {
        var index = this.indexOf(val);
        if (index > -1) {
          this.splice(index, 1);
        }
    };
     $(document).on("click",".upimg-del", function(e) {
         console.log(e.target.nextElementSibling.alt);
         console.log(img_file_list);
         var imgsrc=e.target.nextElementSibling.alt
         for(var i=0;i<img_file_list.length;i++){
            if(imgsrc==img_file_list[i]){
                img_file_list.remove(img_file_list[i])
                // img_file_list=img_file_list.splice(i)
            }
            
            
         }
         for(var k=0;k<$(".upimg-div").length;k++){
            if( $(".upimg-div").eq(k).find('img')[0].alt==imgsrc){
                $(".upimg-div").eq(k).remove();
            }
        }
         console.log("删除以后",img_file_list)

     })
     function question_alert_init() {
        //var question_uploadurl="{:url('set/myupload')}"
        
        ajaxuploadimg.init({
            'url':head_layerTabUploadUrl,//上传路径
            'findElType':'el',
            'uploadimgID':$('.show_image_answersrc').eq(0)[0],//图片id
            'uploadButtonID':$('.show_image_answerbtn').eq(0)[0],//触发上传按钮id
            'uploadFiletype':'upload',
            'lodingpath':'__STATIC__/imgs/loding.gif',//加载图
            success:function (res) {
                res=JSON.parse(res);
                $('.show_image_answersrc').eq(0).attr('src',res.data);
                

                console.log(res);return false;

            }
        });
        let audiopath='__image__/admin/B/icon/yinpinfuwu.png';
        ajaxuploadimg.init({
            'url':head_layerTabUploadUrl,//上传路径
            'findElType':'el',
            'uploadimgID':$('.show_audio_answersrc').eq(0)[0],//图片id
            'uploadButtonID':$('.show_audio_answerbtn').eq(0)[0],//触发上传按钮id
            'uploadFiletype':'upload',
            'lodingpath':'__STATIC__/imgs/loding.gif',//加载图
            success:function (res) {
                res=JSON.parse(res);
                $('.show_audio_answersrc').eq(0).attr('src',res.data);
                
                console.log(res);return false;

            }
        });
        //视频消息
        let vidiopath='__image__/admin/B/icon/shipin.png';
        ajaxuploadimg.init({
            'url':head_layerTabUploadUrl,//上传路径
            'findElType':'el',
            'uploadimgID':$('.show_vido_answersrc').eq(0)[0],//图片id
            'uploadButtonID':$('.show_vido_answerbtn').eq(0)[0],//触发上传按钮id
            'uploadFiletype':'upload',
            'lodingpath':'__STATIC__/imgs/loding.gif',//加载图
            success:function (res) {
                res=JSON.parse(res);
                $('.show_vido_answersrc').eq(0).attr('src',res.data);
                
                console.log(res);return false;

            }
        });



    }
    //打开后初始化
    function head_layertabinit() {

        let audiopath='__image__/admin/B/icon/yinpinfuwu.png';
        ajaxuploadimg.init({
            'url':head_layerTabUploadUrl,
             'findElType':'el',
            'uploadimgID':$("#layertab-audio .uploadaudio").eq(1)[0],//图片id
            'uploadButtonID':$("#layertab-audio .uploadaudio").eq(0)[0],//触发上传按钮id
            'uploadFiletype':'upload',
            'lodingpath':'__STATIC__/imgs/loding.gif',//加载图
            success:function (res) {
                res=JSON.parse(res);
               
                $("#audio_submit").parent().prev().children().attr("src",res.data);
                head_layerTabBefosendData['audio']={
                    'url':res.data,
                    'info':res.info,
                };
                console.log(res);return false;

            }
        });
        //视频消息
        let vidiopath='__image__/admin/B/icon/shipin.png';
        ajaxuploadimg.init({
            'url':head_layerTabUploadUrl,
             'findElType':'el',
            'uploadimgID':$("#layertab-vidio .uploadvidio").eq(1)[0],//图片id
            'uploadButtonID':$("#layertab-vidio .uploadvidio").eq(0)[0],//触发上传按钮id
            'uploadFiletype':'upload',
            'lodingpath':'__STATIC__/imgs/loding.gif',//加载图
            success:function (res) {
                res=JSON.parse(res);
                $("#vidio_submit").parent().prev().children().attr("src",res.data);
                
                head_layerTabBefosendData['video']={
                    'url':res.data,
                    'info':res.info,
                };
                console.log(res);return false;

            }
        });



    }
    function submittypeimg(sid,ajax_type,send_src,sendcontent){
        $.ajax({
            url:YMWL_ROOT_URL+"/admin/manager/addword",
            type: "post",
            data: {sid:sid,type:ajax_type,content: send_src,content_type:ajax_type,content_src:sendcontent}
        }).then(function (res){
            console.log(res);
        });
    }
   
    function head_layertabneibusend(type){
        console.log(type);
        if(flag){
            flag=false
            var sendcontent=''
            var src=''
            var ajax_type='';
            if(type=='wenben'){
               
                src=$("#wenben_submit").attr("data-ajaxurl")
                sendcontent=DomUe.getContent()
                ajax_type='text'
                var ajaxdata= $("#wenben_submit").attr("data-ajaxdata")
                if(sendcontent==''||sendcontent==null){
                    layer.msg("请输入内容")
                    return 0;
                }
                if(ajaxdata!=''){
                    ajaxdata=JSON.parse(ajaxdata)
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();

                        }
                        
                    });
                }
                else if($("#wenben_submit").data("fromid")==0){
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                           // layer.closeAll();
                        }
                        
                    });
                }
                else if($("#wenben_submit").data("fromid")===-1){
                    var ajaxdata={type:ajax_type,content: sendcontent,content_type:type,token:sessionStorage.getItem("token")}
                    if($("#show_dazhaohu").is(":visible")){
                        ajaxdata={
                            type:ajax_type,content: sendcontent,content_type:type,token:sessionStorage.getItem("token"),weigh:$("#dazhaohu_quanzhong").val()
                        }
                    }
                    $.ajax({
                        url:src,
                        type: "post",
                        data: ajaxdata
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                          
                               layer.closeAll('dialog'); 
                               layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                          
                         // layer.closeAll();
                        }
                        
                    });
                }
            }
            else if(type=='img'){
                src=$("#img_submit").attr("data-ajaxurl")
                console.log("img");
                console.log(src);
                // sendcontent=`<img class="chat-img" src="${ $(".uploadimgbtn").eq(1).attr("src")}" >`
                sendcontent= img_file_list;
                console.log(sendcontent);
                if(sendcontent==''||sendcontent==null){
                    layer.msg("请输入内容")
                    return 0;
                }
                ajax_type='image'
                var ajaxdata= $("#img_submit").attr("data-ajaxdata")
                if(ajaxdata!=''){
                    ajaxdata=JSON.parse(ajaxdata)
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent[0],token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                            //layer.closeLast('page'); 
                        }
                        
                    });
                }
                else if($("#img_submit").data("fromid")===0){
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent[0],token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                          // layer.closeAll();
                        }
                        
                    });
                }
                else if($("#img_submit").data("fromid")===-1){
                    
                    $.each(img_file_list,function(i,n){
                        var ajaxdata={type:ajax_type,content: img_file_list[i],token:sessionStorage.getItem("token")}
                        if($("#show_dazhaohu").is(":visible")){
                            ajaxdata={
                                type:ajax_type,content_type:type,content: img_file_list[i],token:sessionStorage.getItem("token"),weigh:$("#dazhaohu_quanzhong").val()
                            }
                        }
                        $.ajax({
                            url:src,
                            type: "post",
                            data: ajaxdata
                        }).then(function (res){
                            console.log(res);
                            if(res.code==1){
                                   // layer.close(index);
                                   layer.closeAll('dialog'); 
                                   layer.closeLast('page')
                                    update_qunfa();
                                    update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                              // layer.closeAll();
                            }
                            
                        });
                    })
                    
                }
            }
            else if(type=='audio'){
                src=$("#audio_submit").attr("data-ajaxurl")
                //sendcontent=`<audio class="chat-img" src="${ $(".uploadaudio").eq(1).attr("src")}" ></audio>`
                sendcontent= $("#audio_submit").parent().prev().children().attr("src")
                ajax_type='audio';
                
                var ajaxdata=  $("#audio_submit").attr("data-ajaxdata");
                if(sendcontent==''||sendcontent==null){
                    layer.msg("请输入内容")
                    return 0;
                }
                if(ajaxdata!=''){
                     ajaxdata=JSON.parse(ajaxdata)
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                           // layer.closeLast('page'); 
                        }
                        
                    });
                }
                else if($("#audio_submit").data("fromid")===0){
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                               // layer.close(index);
                               layer.closeAll('dialog'); 
                               layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                           //layer.closeAll();
                        }
                        
                    });
                }
                else if($("#audio_submit").data("fromid")===-1){
                    var ajaxdata={type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    if($("#show_dazhaohu").is(":visible")){
                        ajaxdata={
                            type:ajax_type,content_type:type,content: sendcontent,token:sessionStorage.getItem("token"),weigh:$("#dazhaohu_quanzhong").val()
                        }
                    }
                    $.ajax({
                        url:src,
                        type: "post",
                        data: ajaxdata
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                               // layer.close(index);
                               layer.closeAll('dialog'); 
                               layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                           //layer.closeAll();
                        }
                        
                    });
                }
            }
            else if(type=='video'){
                src=$("#vidio_submit").attr("data-ajaxurl")
               // sendcontent=`<video class="chat-img" src="${ $(".uploadvidio").eq(1).attr("src")}" ></video>`
                sendcontent= $("#vidio_submit").parent().prev().children().attr("src")
               
                ajax_type='vido'
                var ajaxdata= $("#vidio_submit").attr("data-ajaxdata")
                if(sendcontent==''||sendcontent==null){
                    layer.msg("请输入内容")
                    return 0;
                }
                if(ajaxdata!=''){
                    ajaxdata=JSON.parse(ajaxdata)
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                                //layer.close(index);
                                layer.closeAll('dialog'); 
                                layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                           // layer.closeLast('page'); 
                        }
                        
                    });
                }
                else if($("#vidio_submit").data("fromid")===0){
                    $.ajax({
                        url:src,
                        type: "post",
                        data: {id:ajaxdata.id,type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                               // layer.close(index);
                               layer.closeAll('dialog'); 
                               layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                          // layer.closeAll();
                        }
                        
                    });
                }
                else if($("#vidio_submit").data("fromid")===-1){
                    var ajaxdata={type:ajax_type,content: sendcontent,token:sessionStorage.getItem("token")}
                    if($("#show_dazhaohu").is(":visible")){
                        ajaxdata={
                            type:ajax_type,content_type:type,content: sendcontent,token:sessionStorage.getItem("token"),weigh:$("#dazhaohu_quanzhong").val()
                        }
                    }
                    $.ajax({
                        url:src,
                        type: "post",
                        data: ajaxdata
                    }).then(function (res){
                        console.log(res);
                        if(res.code==1){
                               // layer.close(index);
                               layer.closeAll('dialog'); 
                               layer.closeLast('page')
                                update_qunfa();
                                update_kuaijie();
                                update_dazhaohu();
                                update_zhinengwenda();
                        //   layer.closeAll();
                        }
                        
                    });
                }
            }
        }
        else{
           return 0; 
        }
        
       

    }
    function opentab(e){
        console.log(e);
        var ajaxsrc=location.origin+'/api/Kuaijiehuifu/add'
        head_openLayerTab(ajaxsrc,"add","wenben","kuaijie")
    }
    var qid = 0;
    var DomUe2=''
    
    function resetquestion(){
       layer.closeLast("page");
    }
    // 删除智能问答
    function getdelete(id) {

        $.ajax({
          
            url: location.origin + '/api/Question/del',
            type: 'post',
            async:false,
            beforeSend: function (request) {
                request.setRequestHeader("token",sessionStorage.getItem("token"));
            },
            data: {id: id,token :sessionStorage.getItem("token")},
            success: function (res) {
                if (res.code == 1) {
                    
                     
                     update_qunfa();
                     update_kuaijie();
                     update_dazhaohu();
                     update_zhinengwenda();
                    layer.msg('删除成功', {icon: 1});

                }
            }
        })
    }
    function openquestion(id,type,e){
        question_alert_init();
        qid = id; 
        flag2=true;
        var editdiv_id="hide_answer"+id;
        var editorOption = {
            UEDITOR_HOME_URL: "/assets/ueditor/",
            UEDITOR_ROOT_URL: "/assets/ueditor/",
            serverUrl: "/admin/upload/ueditor/action/config/admin_id/0.html",
            lang: "zh-cn",
            zIndex:"39991015",
            toolbars: [["source","undo", "redo", "|", "bold", "italic", "underline", "fontborder", "strikethrough", "superscript", "subscript", "removeformat", "formatmatch", "autotypeset", "blockquote", "pasteplain", "|", "forecolor", "backcolor",  "selectall", "cleardoc", "|","lineheight", "|", "customstyle", "paragraph", "fontfamily", "fontsize", "|","emotion","link", "unlink","|"]],
            initialContent: "",
            pageBreakTag: "_ueditor_page_break_tag_",
            initialFrameWidth: "100%",
            initialFrameHeight: "160", 
            initialStyle: "body{font-size:14px}",
            autoFloatEnabled: false,
            allowDivTransToP: true,
            autoHeightEnabled: false,
            charset: "utf-8",
        };
        if(id>0){
            var editdiv_id="hide_answer"+id;
            $("#question_save").attr("data-id",id);
            $("#question_content").val(e.dataset.question)
            $("#question_keyword").val(e.dataset.keyword)
            $("#question_sort").val(e.dataset.sort)
           
            $.ajax({
              url: location.origin+'/api/Question/getbyid',
              type: 'post',
              dataType : "json",
              async:false,
              beforeSend: function (request) {
                    request.setRequestHeader("token",sessionStorage.getItem("token"));
              },
              data : { token :sessionStorage.getItem("token"),id:id },
              dataType: 'json',
            
              success: function(res){
                  console.log("编辑详情",res)
                    if(type=='text'){
                        var select = 'dd[lay-value=text]';
                         $("#show_text_answer_value").val($("."+editdiv_id).html())
                        $('#question_type').siblings("div.layui-form-select").find('dl').find(select).click();
                        
                    }
                    else if(type=='image'){
                        var select = 'dd[lay-value=image]';
                        $('#question_type').siblings("div.layui-form-select").find('dl').find(select).click();
                       $(".show_image_answersrc").attr("src",res.data.answer_src)
                    }
                    else if(type=='audio'){
                        var select = 'dd[lay-value=audio]';
                        $('#question_type').siblings("div.layui-form-select").find('dl').find(select).click();
                         $(".show_audio_answersrc").attr("src",res.data.answer_src)
                    }
                    else if(type=='vido'){
                        var select = 'dd[lay-value=vido]';
                        $('#question_type').siblings("div.layui-form-select").find('dl').find(select).click();
                         $(".show_vido_answersrc").attr("src",res.data.answer_src)
                    }
                    
                    layer.open({
                        
                        type: 1,
                        title: id>0?'编辑':'添加',
                        area: ['800px', '600px'],
                        content: $("#alert_question"),
                        success:function(layero, index, that){
                            DomUe2=UE.getEditor("show_text_answer_value",editorOption);
                            console.log(DomUe2)
                            if(id>=1){
                                setTimeout(function(){
                                    DomUe2.setContent(res.data.answer_src)
                                },300)
                            }
                        }
                    });
              }
            })
            
        }
        else{
                
                layer.open({
                    
                    type: 1,
                    title: id>0?'编辑':'添加',
                    area: ['800px', '600px'],
                    content: $("#alert_question"),
                    success:function(layero, index, that){
                        $("#question_content").val('');
                        $("#question_sort").val('');
                        $("#question_keyword").val('');
                        setTimeout(function(){
                             DomUe2=UE.getEditor("show_text_answer_value",editorOption);
                            DomUe2.setContent('')
                        },300)
                    }
                });
        }
        
    }
    function head_openLayerTab(ajax_url,is_show,send_type,data) {
        console.log(ajax_url,is_show,send_type,data);
        flag=true;
        head_layerTabBefosendData={
            'wenben':'',
            'img':'',
            'audio':'',
            'video':'',
        };
        head_layertabinit();
       $("#wenben_submit").attr("data-ajaxurl",ajax_url)
       $("#img_submit").attr("data-ajaxurl",ajax_url)
       $("#audio_submit").attr("data-ajaxurl",ajax_url)
       $("#vidio_submit").attr("data-ajaxurl",ajax_url)
       $("#wenben_submit").attr("data-ajaxdata","")
       $("#img_submit").attr("data-ajaxdata","")
       $("#audio_submit").attr("data-ajaxdata","")
       $("#vidio_submit").attr("data-ajaxdata","")
       $("#wenben_submit").attr("data-fromid","")
       $("#img_submit").attr("data-fromid","")
       $("#audio_submit").attr("data-fromid","")
       $("#vidio_submit").attr("data-fromid","")
       $("#wenben_value").val('')
       

        layer.open({
            type: 1,
            title:is_show=="add"?'添加':"编辑",
            area: ['700px', '500px'], // 宽高
            content: $("#public_lab_alert"),
            success:function(layero, index, that){
               
                if(data=="kuaijie"&&is_show=="add"){
                   $("#wenben_submit").attr("data-fromid","-1")
                   $("#img_submit").attr("data-fromid","-1")
                   $("#audio_submit").attr("data-fromid","-1")
                   $("#vidio_submit").attr("data-fromid","-1")
                   $("#show_dazhaohu").hide();
               }
               if(data=="qunfa"&&is_show=="add"){
                   $("#wenben_submit").attr("data-fromid","-1")
                   $("#img_submit").attr("data-fromid","-1")
                   $("#audio_submit").attr("data-fromid","-1")
                   $("#vidio_submit").attr("data-fromid","-1")
                   $("#show_dazhaohu").hide();
               }
               if(data=="zhinengwenda"&&is_show=="add"){
                   $("#wenben_submit").attr("data-fromid","-1")
                   $("#img_submit").attr("data-fromid","-1")
                   $("#audio_submit").attr("data-fromid","-1")
                   $("#vidio_submit").attr("data-fromid","-1")
                   $("#show_dazhaohu").hide();
               }
               if(data=="dazhaohu"&&is_show=="add"){
                   $("#wenben_submit").attr("data-fromid","-1")
                   $("#img_submit").attr("data-fromid","-1")
                   $("#audio_submit").attr("data-fromid","-1")
                   $("#vidio_submit").attr("data-fromid","-1")
                   $("#show_dazhaohu").hide();
               }
               if(is_show=="edit"){
                   if(send_type=="wenben"){
                        setTimeout(function(){
                            DomUe.setContent(data.content)
                        },300)
                      
                   }
                   
                   $("#wenben_submit").attr("data-ajaxdata",JSON.stringify(data))
                   
                   $("#img_submit").attr("data-ajaxdata",JSON.stringify(data))
                   $("#audio_submit").attr("data-ajaxdata",JSON.stringify(data))
                   $("#vidio_submit").attr("data-ajaxdata",JSON.stringify(data))
               }
            }
        });
    }
    
</script>
<script>
layui.use(function(){
  var element = layui.element;
  
  // hash 地址定位
  var hashName = 'tabid'; // hash 名称
  var layid = location.hash.replace(new RegExp('^#'+ hashName + '='), ''); // 获取 lay-id 值
    
  // 初始切换
  element.tabChange('test-hash', layid);
  // 切换事件
  element.on('tab(test-hash)', function(obj){
    location.hash = hashName +'='+ this.getAttribute('lay-id');
  });
});
</script>
<script type="text/javascript">
    var width =document.body.clientWidth;

    var changeall =function(){
        $("#layout-west").css("width","160px");
        $("#layout-center").css({"position":"absolute","left":"160px","width":(width-160)+"px"});
        $(".info").removeClass("hide");
        $(".west_foot2").removeClass("hide");
        $(".west_foot1").addClass("hide");
        if($(".notices")[0].textContent > 0) {
            $('.notices').removeClass("hide");
            $('.notices-icon').addClass("hide");     
        }
    }
    var changesmall =function(){
        if($(".notices")[0].textContent > 0) {
            $('.notices').removeClass("hide");
        }
    }
    $(document).on("click","#left_info_alert_loginout", function(e) {
         // window.location.href="{:url('admin/login/logout',['business_id'=>$arr['business_id']])}"
         sessionStorage.clear();
        window.location.href=location.origin+"/admin/login/index.html"
    })
    $(document).on("click","#left_info_alert_cpoykami", function(e) {
      // $("#left_info_alert_cpoykami").attr("data-clipboard-text",$("input[name='kami']").eq(0).val());
        var clipboard = new ClipboardJS('#left_info_alert_cpoykami');
        clipboard.on('success', function(e) {
          alert('复制成功');
           e.clearSelection();
          
          e.clearSelection();
        });
        this.click();  //解决clipboard二次点击生效问题
        clipboard.destroy();  //解决多次弹窗
    })
    
    

    setInterval(function(){
        changesmall();
    },1000);
    // if ({$is_bind_wechat}) {
    //     var index = layer.open({
    //         //您还未绑定微信，无法接受模板消息
    //         content: '当前账户未设置OPENID，无法接受模板消息，是否前去绑定'
    //         ,btn: ['前去绑定','忽略']
    //         ,yes: function(index, layero){
    //             $.ajax({
    //                 url: "/admin/index/qrcode.html",
    //                 dataType: 'json',
    //                 success: function (res) {
    //                     layer.close(index);
    //                     layer.open({
    //                         title:'扫码关注,绑定公众号',
    //                         type: 1,
    //                         content: '<img style="width: 200px;height: 200px;" src="'+res.data+'"/>',
    //                     });
    //                 }
    //             });
    //             return false;
    //         },
    //         btn2: function(index, layero){
    //         //按钮【按钮二】的回调

    //         //return false 开启该代码可禁止点击该按钮关闭
    //         }
    //         ,cancel: function(){

    //         }
    //     });
    // }
    function erweima(){
        $('.del-reply').hide();
        $('.manager-reply').text('管理快捷回复')
        layer.open({
            type: 2,
            skin:"tablist",
            title: '二维码',
            area: ['500px', '680px'],
            content: YMWL_ROOT_URL + '/admin/popups/erweima'
        });
    }
    function zserweima(){
        // $('.del-reply').hide();
        // $('.manager-reply').text('管理快捷回复')
        layer.open({
            type: 2,
            skin:"tablist",
            title: '专属二维码',
            area: ['500px', '680px'],
            content: YMWL_ROOT_URL + '/admin/popups/zserweima'
        });
    }
</script>

<div id="layout-center">
    <span id="channel" style="display: none;"></span>
    <span id="customer" style="display: none;"></span>
